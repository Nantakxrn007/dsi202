    {% extends "base.html" %}
    {% load static %}

    {% block body_class %}home-page{% endblock %}
    {% block header_class %}sticky-header{% endblock %}

    {% block content %}
    <link rel="stylesheet" href="{% static 'css/home.css' %}">
    <!-- <link rel="stylesheet" href="{% static 'css/flash_sale_carousel.css' %}"> -->

<div class="p-5 bg-gray-100 mb-5">
        <div class="text-center mb-6">
            <h2 class="text-2xl text-gray-800 font-bold mb-2">üî• Flash Sale üî•</h2>
            <div id="countdown" class="text-red-600 text-xl font-mono animate-pulse">Loading...</div>
          </div>
    <div class="relative flex overflow-hidden px-10">

        <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤ -->
        <button class="prev-button absolute top-1/2 -translate-y-1/2 left-2 w-8 h-8 rounded-full bg-black/30 text-white flex items-center justify-center hover:bg-black/50 z-10">
            <i class="fas fa-chevron-left text-sm"><h1 class="text-2xl"><</h1></i>
        </button>

        <!-- ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ Flash Sale -->
        <div class="flash-sale-carousel flex overflow-x-auto pb-4 space-x-4 scroll-smooth snap-x snap-mandatory [&::-webkit-scrollbar]:hidden">
            {% for product in flash_sale_products %}
            <div class="bg-white rounded-lg shadow-md w-[220px] flex-shrink-0 snap-start transition-transform duration-300 hover:-translate-y-1">
                <a href="{% url 'product_detail' product.id %}" class="block text-inherit no-underline">
                    <div class="relative overflow-hidden rounded-t-lg">
                        <img src="{{ product.image.url }}" alt="{{ product.name }}" class="w-full h-[220px] object-cover">
                        {% for sale_info in product.sale_informations.all %}
                            {% if sale_info.is_on_sale and sale_info.discount_percentage %}
                            <div class="absolute top-2 left-2 bg-red-500 text-white px-2 py-1 rounded text-sm font-bold">
                                ‡∏•‡∏î {{ sale_info.discount_percentage }}%
                            </div>
                            {% endif %}
                        {% endfor %}
                    </div>
                    <div class="p-4 text-center">
                        <div class="text-base font-semibold truncate">{{ product.name }}</div>
                        <div class="flex justify-center items-center gap-2 mb-2">
                            {% if product.original_price %}
                            <span class="line-through text-gray-500 text-sm">{{ product.original_price }} ‡∏ö‡∏≤‡∏ó</span>
                            {% endif %}
                            <span class="text-red-600 text-lg font-bold">{{ product.price }} ‡∏ö‡∏≤‡∏ó</span>
                        </div>
                        {% if product.remaining_stock %}
                        <div class="text-orange-500 text-sm">‡πÄ‡∏´‡∏•‡∏∑‡∏≠ {{ product.remaining_stock }} ‡∏ä‡∏¥‡πâ‡∏ô</div>
                        {% endif %}
                    </div>
                </a>
            </div>
            {% empty %}
            <p>‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ Flash Sale ‡πÉ‡∏ô‡∏Ç‡∏ì‡∏∞‡∏ô‡∏µ‡πâ</p>
            {% endfor %}
        </div>

        <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏ñ‡∏±‡∏î‡πÑ‡∏õ -->
        <button class="next-button absolute top-1/2 -translate-y-1/2 right-2 w-8 h-8 rounded-full bg-black/30 text-white flex items-center justify-center hover:bg-black/50 z-10">
            <i class="fas fa-chevron-right text-sm"><h1 class="text-2xl">></h1></i>
        </button>
    </div>
</div>

    <div class="product-grid">
        {% for product in products %}
        <a href="{% url 'product_detail' product.id %}" class="product-card">
            <img src="{{ product.image.url }}" alt="{{ product.name }}">
            <div class="product-info">
                <div class="product-name">{{ product.name }}</div>
                <div class="product-price">{{ product.price }} ‡∏ö‡∏≤‡∏ó</div>
            </div>
        </a>
        {% endfor %}
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
          const countdownEl = document.getElementById("countdown");
      
          function startCountdown(durationMs) {
            const endTime = new Date(Date.now() + durationMs);
      
            function updateCountdown() {
              const now = new Date();
              let diff = endTime - now;
      
              if (diff <= 0) {
                // ‡∏ô‡∏±‡∏ö‡∏ñ‡∏≠‡∏¢‡∏´‡∏•‡∏±‡∏á‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏´‡∏°‡∏î‡πÄ‡∏ß‡∏•‡∏≤
                startCountdown(durationMs);
                return;
              }
      
              const hours = String(Math.floor(diff / (1000 * 60 * 60))).padStart(2, '0');
              const minutes = String(Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60))).padStart(2, '0');
              const seconds = String(Math.floor((diff % (1000 * 60)) / 1000)).padStart(2, '0');
      
              countdownEl.textContent = `${hours}:${minutes}:${seconds}`;
            }
      
            updateCountdown();
            const interval = setInterval(updateCountdown, 1000);
          }
      
          // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ô‡∏±‡∏ö‡∏ñ‡∏≠‡∏¢‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å 23:59:59 (24 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á = 86400000 ms)
          startCountdown(86400000);
        });
      </script>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const carousel = document.querySelector('.flash-sale-carousel');
            const prevButton = document.querySelector('.prev-button');
            const nextButton = document.querySelector('.next-button');
        
            if (prevButton && nextButton && carousel) {
                const scrollAmount = carousel.offsetWidth - 50;
        
                prevButton.addEventListener('click', function () {
                    carousel.scrollBy({ left: -scrollAmount, behavior: 'smooth' });
                });
        
                nextButton.addEventListener('click', function () {
                    carousel.scrollBy({ left: scrollAmount, behavior: 'smooth' });
                });
        
                function updateButtonVisibility() {
                    const scrollLeft = carousel.scrollLeft;
                    const maxScrollLeft = carousel.scrollWidth - carousel.clientWidth;
        
                    prevButton.style.visibility = scrollLeft <= 5 ? 'hidden' : 'visible';
                    nextButton.style.visibility = scrollLeft >= maxScrollLeft - 5 ? 'hidden' : 'visible';
                }
        
                // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÄ‡∏°‡∏∑‡πà‡∏≠ scroll ‡πÅ‡∏•‡∏∞‡∏ï‡∏≠‡∏ô‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤
                carousel.addEventListener('scroll', updateButtonVisibility);
                updateButtonVisibility();
            }
        });
        </script>
        
    {% endblock %}

