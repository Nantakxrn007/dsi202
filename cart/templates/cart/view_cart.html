{% extends 'base.html' %}
{% load static %}

{% block title %}ตะกร้าสินค้า{% endblock %}

{% block content %}
<div class="py-12 bg-gray-100">
    <div class="bg-white shadow-2xl rounded-3xl p-8 max-w-5xl mx-auto animate-fade-in">
        <h2 class="text-3xl font-bold text-center text-gray-800 mb-8 animate-slide-in-down">ตะกร้าสินค้าของคุณ</h2>

        {% if cart.items.all %}
        <div class="overflow-x-auto">
            <table class="min-w-full bg-white rounded-lg shadow-md">
                <thead class="bg-gray-100">
                    <tr class="text-left">
                        <th class="py-4 px-6 font-semibold text-gray-700">สินค้า</th>
                        <th class="py-4 px-6 font-semibold text-gray-700">ตัวเลือก</th>
                        <th class="py-4 px-6 font-semibold text-gray-700">ราคา</th>
                        <th class="py-4 px-6 font-semibold text-gray-700">จำนวน</th>
                        <th class="py-4 px-6 font-semibold text-gray-700">ลดคาร์บอน</th>
                        <th class="py-4 px-6 font-semibold text-gray-700">รวม</th>
                        <th class="py-4 px-6 font-semibold text-gray-700"></th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in cart.items.all %}
                    <tr class="hover:bg-gray-50 transition duration-300 animate-slide-in-left delay-{{ forloop.counter }}">
                        <td class="py-4 px-6 flex items-center">
                            <img src="{{ item.product.image.url }}" alt="{{ item.product.name }}" class="w-20 h-20 object-cover rounded-lg mr-4 shadow-sm">
                            <div>
                                <div class="font-semibold text-gray-800">{{ item.product.name }}</div>
                            </div>
                        </td>
                        <td class="py-4 px-6">
                            <form method="post" action="{% url 'cart:update_cart_item' item.id %}" class="inline-block">
                                {% csrf_token %}
                                <select name="option_id" class="w-full max-w-xs border border-gray-300 rounded-md p-2 text-sm focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-all duration-200 bg-gray-50">
                                    <option value="">-- ไม่เปลี่ยน --</option>
                                    {% for option in item.product.options.all %}
                                        <option value="{{ option.id }}" {% if item.option.id == option.id %}selected{% endif %}>{{ option.name }}</option>
                                    {% endfor %}
                                </select>
                                <button type="submit" class="bg-yellow-500 hover:bg-yellow-600 text-white font-semibold py-1 px-2 rounded-md text-sm focus:outline-none transition-colors duration-200 mt-2">
                                    เปลี่ยน
                                </button>
                                <div class="flex items-center space-x-2 mt-2">
                                    <label for="quantity_{{ item.id }}" class="text-sm text-gray-700">จำนวน:</label>
                                    <input type="number" name="quantity" id="quantity_{{ item.id }}" value="{{ item.quantity }}" min="1" class="w-16 border border-gray-300 rounded-md p-2 text-center text-sm focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-all duration-200">
                                    <button type="submit" class="bg-green-500 hover:bg-green-600 text-white font-semibold py-1 px-2 rounded-md text-sm focus:outline-none transition-colors duration-200">
                                        อัปเดต
                                    </button>
                                </div>
                            </form>
                        </td>
                        <td class="py-4 px-6 text-red-600 font-bold">{{ item.product.price }} บาท</td>
                        <td class="py-4 px-6">{{ item.quantity }}</td>
                        <td class="py-4 px-6 text-green-600 font-semibold">{{ item.carbon_reduction }} กก.</td>
                        <td class="py-4 px-6">{{ item.total_price }} บาท</td>
                        <td class="py-4 px-6">
                            <form method="POST" action="{% url 'cart:remove_from_cart' item.id %}" class="inline-block">
                                {% csrf_token %}
                                <button type="submit" class="text-red-500 hover:text-red-700 transition duration-200 focus:outline-none">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                        <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h12a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd" />
                                    </svg>
                                </button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <div class="mt-8 flex justify-end space-x-4">
            <div class="text-right">
                <p class="text-xl font-semibold text-gray-800">ยอดรวมทั้งหมด: <span class="text-green-500">{{ cart.total_price }} บาท</span></p>
                <p class="text-lg font-semibold text-gray-700">ลดคาร์บอนทั้งหมด: <span class="text-green-600">{{ cart.total_carbon_reduction }} กก.</span></p>
                <a href="#" class="mt-4 bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-6 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-1 transition-colors duration-200 inline-block">
                    ดำเนินการสั่งซื้อ
                </a>
            </div>
        </div>

        {% else %}
        <p class="text-center text-gray-500 py-8">ไม่มีสินค้าในตะกร้าของคุณ</p>
        {% endif %}
    </div>
</div>

<style>
    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }

    @keyframes slideInDown {
        from { transform: translateY(-20px); opacity: 0; }
        to { transform: translateY(0); opacity: 1; }
    }

    @keyframes slideInLeft {
        from { transform: translateX(-20px); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
    }

    .animate-fade-in {
        animation: fadeIn 0.3s ease-out;
    }

    .animate-slide-in-down {
        animation: slideInDown 0.3s ease-out;
    }

    .animate-slide-in-left {
        animation: slideInLeft 0.3s ease-out;
    }
</style>
{% endblock %}